<script>
    // Конфигурация
    const API_URLS = {
        GENERATE: '/generate',
        CHECK: '/check'
    };

    // Обработчики опций
    const optionsMap = {
        'OPT_LOWERCASE': PasswordOptions.OPT_LOWERCASE,
        'OPT_UPPERCASE': PasswordOptions.OPT_UPPERCASE,
        'OPT_DIGITS': PasswordOptions.OPT_DIGITS,
        'OPT_SPECIAL': PasswordOptions.OPT_SPECIAL,
        'OPT_NO_DIGITS': PasswordOptions.OPT_NO_DIGITS,
        'OPT_SEPARATORS': PasswordOptions.OPT_SEPARATORS,
        'OPT_FULLASCII': PasswordOptions.OPT_FULLASCII,
        'OPT_AVOID_SIMILAR': PasswordOptions.OPT_AVOID_SIMILAR,
        'OPT_NO_REPEAT': PasswordOptions.OPT_NO_REPEAT,
        'OPT_RANDOM_CASE': PasswordOptions.OPT_RANDOM_CASE,
        'OPT_CUSTOM_CHARSET': PasswordOptions.OPT_CUSTOM_CHARSET,
        'OPT_LANGUAGE_SPECIFIC': PasswordOptions.OPT_LANGUAGE_SPECIFIC,
        'OPT_OUTPUT_FORMAT': PasswordOptions.OPT_OUTPUT_FORMAT
    };

    // Генерация пароля
    async function generatePassword() {
        try {
            const options = Array.from(document.querySelectorAll('.option:checked'))
                .map(checkbox => checkbox.value)
                .reduce((acc, val) => acc | optionsMap[val], 0);

            const length = parseInt(document.getElementById('length').value) || 12;

            const response = await fetch(API_URLS.GENERATE, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    length,
                    options: Object.keys(optionsMap).filter(key => (options & optionsMap[key]) !== 0)
                })
            });

            if (!response.ok) throw new Error('Ошибка генерации');
            
            const data = await response.json();
            document.getElementById('generated-password').value = data.password;
            showNotification('Пароль успешно сгенерирован!', 'is-success');

        } catch (error) {
            showNotification(error.message, 'is-danger');
        }
    }

    // Проверка пароля
    async function checkPassword() {
        try {
            const password = document.getElementById('check-password').value;
            if (!password) return;

            const response = await fetch(API_URLS.CHECK, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ password })
            });

            if (!response.ok) throw new Error('Ошибка проверки');
            
            const result = await response.json();
            displayCheckResult(result);

        } catch (error) {
            showNotification(error.message, 'is-danger');
        }
    }

    // Отображение результатов проверки
    function displayCheckResult(result) {
        const resultDiv = document.getElementById('result');
        resultDiv.innerHTML = `
            <div class="notification ${getStrengthClass(result.strength)}">
                <h4 class="title is-5">Результат проверки</h4>
                <p><strong>Уровень сложности:</strong> ${result.strength}</p>
                <p><strong>Энтропия:</strong> ${result.entropy} бит</p>
                <p><strong>Время взлома:</strong> ${formatTime(result.time_to_crack)}</p>
                <p><strong>Утечка данных:</strong> ${result.compromised ? '⚠️ Обнаружена' : '✅ Не обнаружена'}</p>
                
                ${result.warnings.length ? `
                <div class="mt-3">
                    <p class="has-text-weight-bold">Предупреждения:</p>
                    <ul>${result.warnings.map(w => `<li>• ${w}</li>`).join('')}</ul>
                </div>` : ''}
                
                <div class="mt-3">
                    <p class="has-text-weight-bold">Рекомендация:</p>
                    <p>${result.recommendation}</p>
                </div>
            </div>
        `;
    }

    // Вспомогательные функции
    function getStrengthClass(strength) {
        const classes = {
            'Слабый': 'is-danger',
            'Средний': 'is-warning',
            'Надежный': 'is-success',
            'Очень надежный': 'is-primary',
            'Ультра надежный': 'is-info'
        };
        return classes[strength] || '';
    }

    function formatTime(seconds) {
        if (seconds < 1) return 'мгновенно';
        const units = [
            {name: 'лет', div: 31536000},
            {name: 'месяцев', div: 2592000},
            {name: 'дней', div: 86400},
            {name: 'часов', div: 3600},
            {name: 'минут', div: 60}
        ];
        
        for (const unit of units) {
            if (seconds >= unit.div) {
                return `${Math.floor(seconds/unit.div)} ${unit.name}`;
            }
        }
        return `${Math.round(seconds)} секунд`;
    }

    function showNotification(text, type = 'is-info') {
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.textContent = text;
        
        document.body.appendChild(notification);
        setTimeout(() => notification.remove(), 3000);
    }
</script>

<!-- Добавьте в секцию опций генератора -->
<div class="columns is-multiline">
    <div class="column is-4">
        <label class="checkbox">
            <input type="checkbox" class="option" value="OPT_LOWERCASE" checked>
            Строчные буквы (a-z)
        </label>
    </div>
    <div class="column is-4">
        <label class="checkbox">
            <input type="checkbox" class="option" value="OPT_UPPERCASE">
            Заглавные буквы (A-Z)
        </label>
    </div>
    <div class="column is-4">
        <label class="checkbox">
            <input type="checkbox" class="option" value="OPT_DIGITS" checked>
            Цифры (0-9)
        </label>
    </div>
    <div class="column is-4">
        <label class="checkbox">
            <input type="checkbox" class="option" value="OPT_SPECIAL">
            Спецсимволы (!@#...)
        </label>
    </div>
    <div class="column is-4">
        <label class="checkbox">
            <input type="checkbox" class="option" value="OPT_NO_DIGITS">
            Исключить цифры
        </label>
    </div>
    <div class="column is-4">
        <label class="checkbox">
            <input type="checkbox" class="option" value="OPT_AVOID_SIMILAR">
            Исключить похожие символы
        </label>
    </div>
    <div class="column is-4">
        <label class="checkbox">
            <input type="checkbox" class="option" value="OPT_SEPARATORS">
            Добавить разделители
        </label>
    </div>
    <div class="column is-4">
        <label class="checkbox">
            <input type="checkbox" class="option" value="OPT_NO_REPEAT">
            Без повторяющихся символов
        </label>
    </div>
</div>
